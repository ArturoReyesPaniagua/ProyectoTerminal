title Registrar Nuevo Ejercicio - Flujo Completo

actor Usuario

participant MenuRutina
participant ViewRenderer
participant RegistrarEjercicio
participant React
participant Firestore

MenuRutina->ViewRenderer:setCurrentView("registrarEjercicio")
ViewRenderer->RegistrarEjercicio:<RegistrarEjercicio setCurrentView={setCurrentView} />

note over RegistrarEjercicio: Inicialización de estados

RegistrarEjercicio->React:useState("")
React-->RegistrarEjercicio:[nombre, setNombre]

RegistrarEjercicio->React:useState("")
React-->RegistrarEjercicio:[musculo, setMusculo]

RegistrarEjercicio->React:useState("")
React-->RegistrarEjercicio:[pesoMaximo, setPesoMaximo]

RegistrarEjercicio->React:useState("")
React-->RegistrarEjercicio:[repeticionesMaximas, setRepeticionesMaximas]

RegistrarEjercicio->React:useState("")
React-->RegistrarEjercicio:[setsMaximos, setSetsMaximos]

RegistrarEjercicio->React:useState("")
React-->RegistrarEjercicio:[descripcion, setDescripcion]

RegistrarEjercicio->React:useState(false)
React-->RegistrarEjercicio:[loading, setLoading]

RegistrarEjercicio->React:useState([])
React-->RegistrarEjercicio:[ejerciciosExistentes, setEjerciciosExistentes]

RegistrarEjercicio->React:useEffect(() => cargarEjerciciosExistentes(), [])
React-->RegistrarEjercicio:cargarEjerciciosExistentes()

RegistrarEjercicio->Firestore:getDocs(collection(db, "ejercicios"))
Firestore-->RegistrarEjercicio:ejerciciosSnapshot

RegistrarEjercicio->React:setEjerciciosExistentes(ejerciciosList)
RegistrarEjercicio<--React:return

RegistrarEjercicio-->Usuario:Muestra formulario con:\n- Info ejercicios existentes\n- Campos del formulario\n- Botones de acción
Usuario->RegistrarEjercicio:Ingresa nombre "Press de Banca"
RegistrarEjercicio->React:setNombre("Press de Banca")
React-->RegistrarEjercicio:return

Usuario<--RegistrarEjercicio:Muestra formulario actualizado
Usuario->RegistrarEjercicio:Selecciona músculo "Pecho"
RegistrarEjercicio->React:setMusculo("Pecho")
React-->RegistrarEjercicio:return

Usuario<--RegistrarEjercicio:Muestra formulario actualizado
Usuario->RegistrarEjercicio:Ingresa peso máximo "80"
RegistrarEjercicio->React:setPesoMaximo("80")
React-->RegistrarEjercicio:return

Usuario<--RegistrarEjercicio:Muestra formulario actualizado
Usuario->RegistrarEjercicio:Ingresa repeticiones "10"
RegistrarEjercicio->React:setRepeticionesMaximas("10")
React->RegistrarEjercicio:Re-render

Usuario->RegistrarEjercicio:Ingresa sets "4"
RegistrarEjercicio->React:setSetsMaximos("4")
React-->RegistrarEjercicio:return

note over RegistrarEjercicio: Muestra info calculada:\n- Volumen: 3200 kg×reps×sets\n- Categoría: Empuje Superior\n- 1RM: 92kg

Usuario->RegistrarEjercicio:Click "Registrar Ejercicio"
RegistrarEjercicio->RegistrarEjercicio:registrarEjercicio()

RegistrarEjercicio->RegistrarEjercicio:validarDatos()
note right of RegistrarEjercicio: Validaciones:\n- Nombre >= 3 chars\n- No duplicado\n- Músculo seleccionado\n- Peso > 0 y <= 500\n- Reps > 0 y <= 50\n- Sets > 0 y <= 20

alt Validación exitosa
    RegistrarEjercicio->React:setLoading(true)
    React-->RegistrarEjercicio:return
    
    RegistrarEjercicio->Firestore:setDoc(\n  doc(collection(db, "ejercicios")),\n  {\n    nombre: "Press de Banca",\n    musculo: "Pecho",\n    pesoMaximo: 80,\n    repeticionesMaximas: 10,\n    setsMaximos: 4,\n    volumenBase: 3200,\n    categoria: "Empuje Superior",\n    activo: true,\n    fechaCreacion: new Date().toISOString()\n  }\n)
    Firestore-->RegistrarEjercicio:success
    
    RegistrarEjercicio-->Usuario:Alert "¡Ejercicio registrado con éxito!"
    
    RegistrarEjercicio->RegistrarEjercicio:cargarEjerciciosExistentes()
    
    RegistrarEjercicio->RegistrarEjercicio:confirm("¿Registrar otro?")
    RegistrarEjercicio-->Usuario:Muestra confirmación
    
    alt Usuario cancela
        Usuario->RegistrarEjercicio:Click Cancelar
        RegistrarEjercicio->React:setCurrentView("menuRutina")
        ViewRenderer<--React:return
        
        ==ir inicio index==
    else Usuario acepta
        Usuario->RegistrarEjercicio:Click OK
React<--RegistrarEjercicio:setCurrentView("menuRutina")
ViewRenderer<--React:return
  ==ir inicio index==

    end
    
else Validación fallida
    RegistrarEjercicio-->Usuario:Alert con errores:\n- "Nombre debe tener 3+ chars"\n- "Ya existe este ejercicio"\n
end


alt Navegación

    
    opt Regresar
        Usuario->RegistrarEjercicio:Click "Regresar"
        RegistrarEjercicio->React:setCurrentView("menuRutina")
ViewRenderer<--React:return
  ==ir inicio index==
    end
end
