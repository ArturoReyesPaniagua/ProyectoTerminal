title Historial de Progreso

actor Usuario

participant CalculoGrasa
participant ViewRenderer
participant Historial
participant React
participant Firestore 

ViewRenderer->Historial:<Historial setCurrentView={setCurrentView} />


Historial->React:useState([])
React-->Historial:[historialData, setHistorialData]

Historial->React:useState(true)
React-->Historial:[loading, setLoading]

Historial->React:useState("grasa")
React-->Historial:[vistaActual, setVistaActual]

Historial->React:useEffect(() => cargarHistorial(), [])
React->Historial:cargarHistorial()

Historial->Firestore:getDocs(\n  query(\n    collection(db, "usuarios", uid, "historial"),\n    orderBy("fecha", "desc")\n  )\n)
Firestore-->Historial:historialSnapshot


Historial->React:setHistorialData(historialConGrasa)
Historial<--React:return
Historial->React:setLoading(false)
Historial<--React:return

alt Hay datos históricos
    
    Historial-->Usuario:Muestra:\n- Tabs (Grasa / Medidas)\n- Vista actual seleccionada
    alt Vista Porcentaje Grasa
        Usuario->Historial:Tab "Porcentaje de Grasa" activo
        
        Historial->Historial:obtenerTendencia(datos, "porcentajeGrasa")
        note right of Historial: Calcula tendencia:\n- Si bajó: "Disminuyendo" ✓\n- Si subió: "Aumentando" ⚠\n- Sin cambio: "→"
        
        Historial-->Usuario:Muestra:\n- % actual grande (15.3%)\n- Última medición fecha\n- Tendencia con color\n- Lista histórica
        
        note over Usuario: Ve cada entrada con:\n- % grasa\n- Fecha\n- Peso\n- Diferencia vs anterior
    end
    
    alt Vista Medidas Corporales
        Usuario->Historial:Click tab "Medidas Corporales"
        Historial->React:setVistaActual("medidas")
        
Historial<--React:return
        React-->Usuario:Muestra:\n- Grid 4 medidas principales\n- Valor actual\n- Tendencia cada medida\n- Historial detallado
        
        note over Usuario: Ve evolución de:\n- Peso\n- Cintura\n- Cuello\n- Cuádriceps
    end
    
    Usuario->Historial:Click "Calcular Grasa Actual"
    Historial->React:setCurrentView("grasa")
    
Historial<--React:return
== ir a index inicia==
    
else No hay datos
    Historial->React:Renderiza estado vacío
    React-->Usuario:Muestra:\n"No hay datos de historial"
    
    Usuario->Historial:Click "Registrar Primeros Datos"
    Historial->React:setCurrentView("formularioDatos")
Historial<--React:return 
== ir a index inicia ==
end

Usuario->Historial:Click "Regresar al Menú"

Historial->React:setCurrentView("menuPrincipal")

Historial<-React:return
== ir a index inicia ==